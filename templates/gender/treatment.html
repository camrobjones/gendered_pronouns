{% extends 'gender_base.html' %}

{% block content %}

<script>

// Dynamically alter height of text inputs in case participants go over one line
function adjustHeight(el) {
    // console.log(el)
    el.style.height = (el.scrollHeight + 2) + "px";
}

// Stop participants from filling in boxes in the wrong order
function unlock(n) {
    let inputs = document.getElementsByClassName('inline-input')
    if (n > 0) {
        // disable previous input
        let prev = inputs[n-1]
        prev.classList.add("disabled");
    }
    console.log(n)
    if (n < 2) {
        let next = inputs[n+1]
        next.classList.remove("disabled");
    } else {
        document.getElementById('next').disabled = false;
    }
}

</script>

<form action="/gp/mediator" method="POST">
{% csrf_token %}

<input type="hidden" name="treatment_gender" value="{{treatment}}">
<input type="hidden" name="treatment_pronoun" value="{{pronouns.0}}">
<input type="hidden" name="db_id" value="{{db_id}}">

<p>
    The following task requires you to use your skills in visual recognition. 
</p>

<img class="treatment_stimulus" src="/static/gender/stim_{{treatment}}.jpg"/>

<p class="question">
    Please use the text boxes below to continue the three sentences about what the person in the image is doing. Please be as specific as possible and provide as much detail as you can.

</p>

<p class='treatment-container'>
    <span class='treatment-label'> {{pronouns.0}} </span>  
    <textarea class="inline-input" onkeyup="adjustHeight(this)" onchange="unlock(0)" id="treatment_1" name="treatment_1" required></textarea>
</p>

<p class='treatment-container'> 
    <span class='treatment-label'> {{pronouns.0}} </span> 
    <textarea class="inline-input disabled" onkeyup="adjustHeight(this)" onchange="unlock(1)" id="treatment_1" name="treatment_2"required></textarea>
</p>

<p class='treatment-container'> 
    <span class='treatment-label'> {{pronouns.1}} </span> 
    <textarea class="inline-input disabled" onkeyup="adjustHeight(this)" onchange="unlock(2)" id="treatment_2" name="treatment_3" required></textarea>
</p>


<div class='button-container'>
    <input type='submit' value="Next" class='btn btn-dark' id="next" disabled>
</div>

</form>

<script>

let labels = document.getElementsByClassName('treatment-label')
let inputs = document.getElementsByClassName('inline-input')

for (i=0; i<3; i++) {
    inputs[i].style.textIndent = labels[i].offsetWidth + 5 + "px"
}
</script>

{% endblock %}

